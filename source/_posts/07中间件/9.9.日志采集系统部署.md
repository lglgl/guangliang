



192.168.10.92：kafka-zookeeper-kafkamanager

192.168.10.72：filebeat-

192.168.10.71：kibana-es

安装es(71)

```
[root@node73 ~]# mkdir -p /usr/local/docker_data/elasticsearch/data
[root@node73 ~]# mkdir -p /usr/local/docker_data/elasticsearch/logs
[root@node73 ~]# mkdir -p /usr/local/docker_data/elasticsearch/plugins

docker run -it \
--name dev-es-standalone-01 \
--restart=always \
-p 9200:9200 \
-p 9300:9300 \
-e ES_JAVA_OPTS="-Xms512m -Xmx1024m" \
-e "discovery.type=single-node" \
docker.elastic.co/elasticsearch/elasticsearch:7.15.2





health status index                           uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .geoip_databases                IX8SaXizQkC0uHunM2Hwmw   1   0         42            0     39.9mb         39.9mb
green  open   .apm-custom-link                cJm8GijZSZSPoGpRVGBcEg   1   0          0            0       208b           208b
green  open   .apm-agent-configuration        N7VfBedDRDOLf4UU_1fQyQ   1   0          0            0       208b           208b
green  open   .kibana-event-log-7.15.2-000001 4jgSZhEMTiu3kPKvGWAnAQ   1   0          3            0     12.2kb         12.2kb
green  open   .kibana_7.15.2_001              msQTKdTgSLiio_y2hDNeOw   1   0         49            0      4.6mb          4.6mb
green  open   .tasks                          NdEDalLMSQCph51iRfzf9Q   1   0          2            0     13.8kb         13.8kb
green  open   .kibana_task_manager_7.15.2_001 686bNnjLS4-wiHKeKkxjag   1   0         15         6849    895.4kb        895.4kb


```

查看所有索引：https://192.168.10.71:9200/_cat/indices?v&pretty



docker cp dev-mysql-standalone-01:/etc/my.cnf /root/my.cnf

安装kibana

```
docker run -d --name dev-kibana-standalone-01 --net elastic -p 5601:5601 -e "ELASTICSEARCH_HOSTS=http://192.168.10.73:9200/" docker.elastic.co/kibana/kibana:7.15.2

```





Logstash

[Configuring Logstash for Docker | Logstash Reference [8.8\] | Elastic](https://www.elastic.co/guide/en/logstash/current/docker-config.html)

```
docker pull docker.elastic.co/logstash/logstash:8.2.0
mkdir -p /root/logstash/{pipeline,config,data}


mkdir -p ~/settings

docker run --rm -it -v ~/settings/:/usr/share/logstash/config/  docker.elastic.co/logstash/logstash:8.8.1

 docker run --rm -it -v ~/settings/logstash.conf:/usr/share/logstash/config/logstash.conf -v ~/settings/logstash.yml:/usr/share/logstash/config/logstash.yml  -v ~/settings/pipelines.yml:/usr/share/logstash/config/pipelines.yml docker.elastic.co/logstash/logstash:7.15.2
 
 
 es api key
 
 S05XZ3VJZ0JzZzE5NWo1WGlhNC06dE05OEJMV0NTSjIzVkFNWkw3QXZVUQ==
```





zookeeper(92)

```
docker run --name dev-elk-zookeeper-01 --privileged -p 2181:2181  -d zookeeper:3.7.1
```





kafka

- 部署参考官网：[Apache Kafka](https://kafka.apache.org/quickstart)

1、下载`kafka3.4.0`

- Scala 2.13  - [kafka_2.13-3.4.0.tgz](https://downloads.apache.org/kafka/3.4.0/kafka_2.13-3.4.0.tgz) ([asc](https://downloads.apache.org/kafka/3.4.0/kafka_2.13-3.4.0.tgz.asc), [sha512](https://downloads.apache.org/kafka/3.4.0/kafka_2.13-3.4.0.tgz.sha512))

2、新建`/root/kafka`文件夹，解压安装包

3、编辑server.properties，仅修改以下三行。

```
broker.id=1

############################# Socket Server Settings #############################

# The address the socket server listens on. If not configured, the host name will be equal to the value of
# java.net.InetAddress.getCanonicalHostName(), with PLAINTEXT listener name, and port 9092.
#   FORMAT:
#     listeners = listener_name://host_name:port
#   EXAMPLE:
#     listeners = PLAINTEXT://your.host.name:9092
listeners=PLAINTEXT://0.0.0.0:9092

# Listener name, hostname and port the broker will advertise to clients.
# If not set, it uses the value for "listeners".
advertised.listeners=PLAINTEXT://192.168.10.92:9092
```

4、后台启动

```
nohup /root/kafka/kafka_2.13-3.4.0/bin/kafka-server-start.sh /root/kafka/kafka_2.13-3.4.0/bin/config/server.properties & 



[root@idszt-node92 kafka]# pwd
/root/kafka
[root@idszt-node92 kafka]# bin/kafka-server-start.sh config/server.properties

```

kafka manager(91)

```
docker run -p 8080:8080 -e KAFKA_BROKERS=192.168.10.92:9092 docker.redpanda.com/redpandadata/console:latest
```







filebeat



```
#查找大于50M的日志
find / -type f -size +50240k -exec ls -lh {} \;

/opt/infra/apache-zookeeper-3.7.1-bin/logs/version-2/log.200000001

#运行
./filebeat -e -c filebeat.yml
```

