
---
title: 4.2.系统加固2

---

### 1、打开防火墙
```shell
firewall-cmd --list-all
firewall-cmd --reload
systemctl restart firewalld.service
systemctl stop firewalld.service
systemctl start firewalld.service
systemctl status firewalld.service

# 设置三台虚拟机互通（不做防火墙限制）
firewall-cmd --permanent --add-source=10.128.136.138
firewall-cmd --permanent --add-source=10.128.136.139
firewall-cmd --permanent --add-source=10.128.136.140
firewall-cmd --permanent --add-source=10.128.136.140
firewall-cmd --permanent --add-source=113.98.244.181
firewall-cmd --permanent --remove-port=60022/tcp
firewall-cmd --permanent --remove-port=22/tcp
firewall-cmd --reload
firewall-cmd --reload
```

### 2、检测到远端X服务正在运行中(CVE-1999-0526)
```shell
停止Xserver
systemctl stop gdm
systemctl disable gdm
systemctl status gdm
systemctl start gdm
systemctl enable gdm
```

### 3、可通过HTTP获取远端WWW服务信息
关闭nginx 80/443端口

注释以下路径的80端口侦听
`/data/middleware/nginx/config/conf.d/`


### 4、修改ssh版本号（版本欺骗）
```shell
cp /usr/bin/ssh /usr/bin/ssh.bak
cp /usr/sbin/sshd /usr/sbin/sshd.bak
sed -i 's/OpenSSH_7.4/OpenSSH_8.6/g' /usr/sbin/sshd
sed -i 's/OpenSSH_7.4/OpenSSH_8.6/g' /usr/bin/ssh
```


### 5、SSH版本信息可被获取（修复）
 修改源代码或者配置文件改变SSH服务的缺省banner。
```shell
echo "Welcome to XX Airport" > /etc/ssh_banner_idszt
vi /etc/ssh/sshd_config
echo "Banner /etc/ssh_banner_idszt" >> /etc/ssh/sshd_config
tail -n 10 /etc/ssh/sshd_config
systemctl restart sshd
```

###  6、检测到远端RPCBIND/PORTMAP正在运行中(CVE-1999-0632)
```shell
关闭 rpcbind 服务
systemctl disable rpcbind
systemctl stop rpcbind.socket
```
### 7、修复ICMP timestamp请求响应漏洞
* 在您的防火墙上过滤外来的ICMP timestamp（类型 13）报文以及外出的ICMP timestamp回复报文
```shell
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p ICMP --icmp-type timestamp-request -m comment --comment "deny ICMP timestamp" -j DROP
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p ICMP --icmp-type timestamp-reply -m comment --comment "deny ICMP timestamp" -j DROP
# 禁止Traceroute探测
firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p ICMP --icmp-type 11 -m comment --comment "deny traceroute" -j DROP
firewall-cmd --reload

firewall-cmd --direct --get-all-rules
```


### 8、修改ssh端口（慎重选择）
先操作一台机器，不同时操作。因为修改端口后，数据包不一定能通过防火墙。

配置文件调整/etc/ssh/sshd_config
```
vi /etc/ssh/sshd_config

#port 22
#改为
port 60022
```
systemctl restart sshd

检查： netstat -ntlp



### 基线脚本执行



1、上传文件夹Linux_配置规范_已修改_S3A3G3到root目录
2、cd /root
3、执行chmod +x ffabcdef-2021-1115-1707-aaa510893517.sh
4、cd /tmp
5、导出xml文件


-----------------------------
时间服务：10.128.143.33
